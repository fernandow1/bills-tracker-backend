services:
  db:
    image: mysql:8.0
    container_name: bills-tracker-db
    restart: always
    ports:
      - '3308:3306'
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    volumes:
      - db_data:/var/lib/mysql

  db-test:
    image: mysql:8.0
    container_name: bills-tracker-db-test
    restart: always
    ports:
      - '3309:3306' # Puerto diferente para BD de pruebas
    environment:
      MYSQL_ROOT_PASSWORD: ${TEST_DB_ROOT_PASSWORD:-testroot}
      MYSQL_DATABASE: ${TEST_DB_NAME:-bills_tracker_test}
      MYSQL_USER: ${TEST_DB_USER:-testuser}
      MYSQL_PASSWORD: ${TEST_DB_PASSWORD:-testpass}
    volumes:
      - db_test_data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    container_name: bills-tracker-redis
    restart: always
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes

volumes:
  db_data:
    driver: local
  db_test_data:
    driver: local
  redis_data:
    driver: local
